<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Todo Liste med Kategorier & Dark Mode</title>
<style>
  :root {
    --light-bg: linear-gradient(135deg, #e0eaff, #f7f9ff);
    --light-text: #222;
    --dark-bg: #121212;
    --dark-text: #eee;
    --dark-input-bg: #000;
    --accent-color: #3b5bff;
    --danger-color: #ff4d4d;
  }
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    max-width: 700px;
    margin: 2rem auto;
    padding: 1rem;
    background: var(--light-bg);
    color: var(--light-text);
    border-radius: 10px;
    transition: background-color 0.3s ease, color 0.3s ease;
  }
  body.dark-mode {
    background: var(--dark-bg);
    color: var(--dark-text);
  }
  h1 {
    text-align: center;
    color: var(--accent-color);
  }
  .hero-intro {
    text-align: center;
    margin-bottom: 2rem;
    animation: fadeIn 1.5s ease forwards;
    opacity: 0;
  }
  @keyframes fadeIn {
    to { opacity: 1; }
  }
  #theme-toggle {
    display: block;
    margin: 1rem auto;
    padding: 0.5rem 1rem;
    border: none;
    background: var(--accent-color);
    color: white;
    border-radius: 6px;
    cursor: pointer;
    font-size: 1rem;
  }
  #category-controls {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }
  #categories {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    justify-content: center;
  }
  .category {
    background-color: var(--accent-color);
    color: white;
    border-radius: 20px;
    padding: 0.3rem 0.8rem;
    display: flex;
    align-items: center;
    gap: 0.3rem;
    cursor: pointer;
  }
  .category.active {
    background-color: #2a46d8;
  }
  .category span {
    font-weight: bold;
  }
  .category button {
    background: transparent;
    border: none;
    color: white;
    cursor: pointer;
    font-size: 1rem;
    padding: 0;
    margin-left: 0.2rem;
    user-select: none;
  }
  #new-category-input {
    width: 100%;
    padding: 0.6rem;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 1rem;
    outline-offset: 0;
  }
  body.dark-mode #new-category-input {
    background-color: var(--dark-input-bg);
    color: var(--dark-text);
    border: 1px solid white;
  }
  #active-category-label {
    text-align: center;
    font-size: 1.2rem;
    font-weight: bold;
    margin-bottom: 1rem;
  }
  todo-form, todo-list {
    display: block;
    margin-bottom: 1rem;
  }
  todo-form .form-container {
    display: flex;
    gap: 0.5rem;
  }
  todo-form input[type="text"] {
    flex: 1;
    padding: 0.6rem;
    font-size: 1rem;
    border: 1px solid #ccc;
    border-radius: 6px;
    background-color: inherit;
    color: inherit;
    outline-offset: 0;
  }
  body.dark-mode todo-form input[type="text"] {
    background-color: var(--dark-input-bg);
    color: var(--dark-text);
    border: 1px solid white;
  }
  todo-form button {
    background-color: var(--accent-color);
    color: white;
    border: none;
    padding: 0.6rem 1rem;
    border-radius: 6px;
    cursor: pointer;
    font-size: 1rem;
  }
  todo-list ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  todo-task {
    display: block;
    background: #f0f4ff;
    margin-bottom: 0.5rem;
    padding: 0.75rem 1rem;
    border-left: 4px solid var(--accent-color);
    border-radius: 6px;
    transition: 0.3s;
    animation: fadeIn 0.3s ease-in-out;
    color: #222;
  }
  body.dark-mode todo-task {
    background: #222;
    color: var(--dark-text);
    border-left-color: var(--accent-color);
  }
  todo-task.done {
    text-decoration: line-through;
    color: gray;
    opacity: 0.7;
  }
  body.dark-mode todo-task.done {
    color: #999;
    opacity: 0.7;
  }
  todo-task .container {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  todo-task input[type="checkbox"] {
    cursor: pointer;
    width: 18px;
    height: 18px;
  }
  todo-task span.task-text {
    flex: 1;
    user-select: none;
  }
  todo-task button.time-btn,
  todo-task button.delete-btn {
    background: transparent;
    border: none;
    font-size: 1.3rem;
    cursor: pointer;
    user-select: none;
    padding: 0;
    margin-left: 0.3rem;
    line-height: 1;
    transition: color 0.3s ease;
  }
  todo-task button.time-btn:hover {
    color: #1a2fcc;
  }
  todo-task button.delete-btn {
    color: var(--danger-color);
  }
  todo-task button.delete-btn:hover {
    color: #ff0000;
  }
  todo-task span.time {
    font-size: 0.85rem;
    color: #555;
    user-select: none;
    margin-left: 0.5rem;
    white-space: nowrap;
  }
  body.dark-mode todo-task span.time {
    color: #bbb;
  }
  @keyframes fadeIn {
    from { opacity: 0; transform: scale(0.95); }
    to { opacity: 1; transform: scale(1); }
  }
</style>
</head>
<body>
  <section class="hero-intro">
    <h1>üìù Min To-Do Liste</h1>
    <p>Organiser dine opgaver og kategorier nemt og hurtigt.</p>
  </section>

  <button id="theme-toggle">üåò Skift Tema</button>

  <div id="category-controls">
    <div id="categories"></div>
    <input id="new-category-input" placeholder="Skriv kategori-navn og tryk Enter..." autocomplete="off" />
  </div>

  <div id="active-category-label">Ingen aktiv kategori valgt</div>

  <todo-form></todo-form>
  <todo-list></todo-list>

<script>
  let categories = JSON.parse(localStorage.getItem('todo-categories') || '{}');
  let activeCategory = localStorage.getItem('active-category') || null;

  function saveCategories() {
    localStorage.setItem('todo-categories', JSON.stringify(categories));
  }

  function renderCategories() {
    const container = document.getElementById('categories');
    container.innerHTML = '';
    Object.keys(categories).forEach(name => {
      const cat = document.createElement('div');
      cat.className = 'category' + (name === activeCategory ? ' active' : '');
      cat.innerHTML = `<span>${name}</span><button title="Slet kategori">üóëÔ∏è</button>`;

      cat.querySelector('span').onclick = () => {
        activeCategory = name;
        localStorage.setItem('active-category', name);
        renderCategories();
        renderTasks();
        updateActiveCategoryLabel();
      };

      cat.querySelector('button').onclick = () => {
        if(confirm(`Vil du slette kategorien "${name}" og alle dens opgaver?`)) {
          delete categories[name];
          if (activeCategory === name) activeCategory = null;
          saveCategories();
          renderCategories();
          renderTasks();
          updateActiveCategoryLabel();
        }
      };

      container.appendChild(cat);
    });
  }

  function updateActiveCategoryLabel() {
    const label = document.getElementById('active-category-label');
    label.textContent = activeCategory ? `üìÇ ${activeCategory}` : 'Ingen aktiv kategori valgt';
  }

  document.getElementById('new-category-input').addEventListener('keypress', e => {
    if (e.key === 'Enter') {
      const name = e.target.value.trim();
      if (!name) return;
      if (categories[name]) {
        alert('Kategori findes allerede!');
        e.target.value = '';
        return;
      }
      categories[name] = [];
      activeCategory = name;
      saveCategories();
      localStorage.setItem('active-category', name);
      renderCategories();
      renderTasks();
      updateActiveCategoryLabel();
      e.target.value = '';
    }
  });

  class TodoTask extends HTMLElement {
    constructor() {
      super();
      this.attachShadow({ mode: 'open' });
    }
    connectedCallback() {
      this.render();
    }
    render() {
      const text = this.getAttribute('text') || '';
      const done = this.hasAttribute('done');
      const time = this.getAttribute('time') || '';

      this.shadowRoot.innerHTML = `
        <style>
          .container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
          }
          input[type="checkbox"] {
            cursor: pointer;
            width: 18px;
            height: 18px;
          }
          span.task-text {
            flex: 1;
            user-select: none;
          }
          button.time-btn,
          button.delete-btn {
            background: transparent;
            border: none;
            font-size: 1.3rem;
            cursor: pointer;
            user-select: none;
            padding: 0;
            margin-left: 0.3rem;
            line-height: 1;
            transition: color 0.3s ease;
          }
          button.time-btn:hover {
            color: #1a2fcc;
          }
          button.delete-btn {
            color: var(--danger-color);
          }
          button.delete-btn:hover {
            color: #ff0000;
          }
          span.time {
            font-size: 0.85rem;
            color: #555;
            user-select: none;
            margin-left: 0.5rem;
            white-space: nowrap;
          }
          :host(.done) span.task-text {
            text-decoration: line-through;
            color: gray;
            opacity: 0.7;
          }
          body.dark-mode :host(.done) span.task-text {
            color: #999;
            opacity: 0.7;
          }
        </style>
        <div class="container">
          <input type="checkbox" ${done ? 'checked' : ''} />
          <span class="task-text">${text}</span>
          <button class="time-btn" title="Tilf√∏j tidspunkt">‚è∞</button>
          <span class="time">${time}</span>
          <button class="delete-btn" title="Slet opgave">üóëÔ∏è</button>
        </div>
      `;

      const checkbox = this.shadowRoot.querySelector('input[type="checkbox"]');
      const deleteBtn = this.shadowRoot.querySelector('button.delete-btn');
      const timeBtn = this.shadowRoot.querySelector('button.time-btn');
      const timeSpan = this.shadowRoot.querySelector('span.time');

      this.classList.toggle('done', done);

      checkbox.onchange = () => {
        this.classList.toggle('done', checkbox.checked);
        saveTasksFromDOM();
      };

      deleteBtn.onclick = () => {
        this.remove();
        saveTasksFromDOM();
      };

      timeBtn.onclick = () => {
        const newTime = prompt('Indtast tidspunkt for opgaven (f.eks. 14:30)', time);
        if (newTime !== null) {
          this.setAttribute('time', newTime.trim());
          timeSpan.textContent = newTime.trim();
          saveTasksFromDOM();
        }
      };
    }
  }

  class TodoList extends HTMLElement {
    connectedCallback() {
      this.innerHTML = '<ul id="tasks"></ul>';
    }
    addTask(task) {
      const taskEl = document.createElement('todo-task');
      taskEl.setAttribute('text', task.text);
      if (task.done) taskEl.setAttribute('done', '');
      if (task.time) taskEl.setAttribute('time', task.time);
      this.querySelector('#tasks').appendChild(taskEl);
    }
    clearTasks() {
      this.querySelector('#tasks').innerHTML = '';
    }
  }

  class TodoForm extends HTMLElement {
    connectedCallback() {
      this.innerHTML = `
        <div class="form-container">
          <input type="text" placeholder="Skriv en opgave..." autocomplete="off" />
          <button>Tilf√∏j</button>
        </div>
      `;
      const input = this.querySelector('input');
      const btn = this.querySelector('button');

      btn.onclick = () => {
        const val = input.value.trim();
        if (!val) {
          alert('Skriv venligst en opgave.');
          return;
        }
        if (!activeCategory) {
          alert('V√¶lg venligst en kategori f√∏rst.');
          return;
        }
        categories[activeCategory].push({ text: val, done: false, time: '' });
        saveCategories();
        renderTasks();
        input.value = '';
      };

      input.addEventListener('keypress', e => {
        if (e.key === 'Enter') btn.click();
      });
    }
  }

  function renderTasks() {
    const list = document.querySelector('todo-list');
    list.clearTasks();
    if (activeCategory && categories[activeCategory]) {
      categories[activeCategory].forEach(task => list.addTask(task));
    }
    updateActiveCategoryLabel();
  }

  function saveTasksFromDOM() {
    const list = document.querySelector('todo-list');
    const tasks = [];
    list.querySelectorAll('todo-task').forEach(taskEl => {
      tasks.push({
        text: taskEl.getAttribute('text'),
        done: taskEl.classList.contains('done'),
        time: taskEl.getAttribute('time') || ''
      });
    });
    if (activeCategory) {
      categories[activeCategory] = tasks;
      saveCategories();
      renderTasks();
    }
  }

  document.getElementById('theme-toggle').onclick = () => {
    document.body.classList.toggle('dark-mode');
  };

  customElements.define('todo-task', TodoTask);
  customElements.define('todo-list', TodoList);
  customElements.define('todo-form', TodoForm);

  renderCategories();
  renderTasks();
</script>
</body>
</html>
